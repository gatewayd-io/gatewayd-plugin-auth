# yaml-language-server: $schema=https://docs.gatewayd.io/config_plugins_schema.json
compatibilityPolicy: "strict"

# IMPORTANT: This plugin requires backend pool connections to be pre-authenticated.
# In your gatewayd.yaml, add startupParams to each client block:
#
#   clients:
#     default:
#       writes:
#         address: localhost:5432
#         startupParams:
#           user: postgres
#           database: postgres
#           password: postgres

plugins:
  - name: gatewayd-plugin-auth
    enabled: True
    localPath: ../gatewayd-plugin-auth/gatewayd-plugin-auth
    args: ["--log-level", "info"]
    checksum: 63667643806884b3286251337b1340e7319899675264931c689444d322444382
    url: github.com/gatewayd-io/gatewayd-plugin-auth@latest
    env:
      - MAGIC_COOKIE_KEY=GATEWAYD_PLUGIN
      - MAGIC_COOKIE_VALUE=5712b87aa5d7e9f9e9ab643e6603181c5b796015cb1c09d6f5ada882bf2a1872
      # Authentication method used for client-side identity brokering.
      # Supported: cleartext, md5, scram-sha-256
      - AUTH_TYPE=md5
      # Path to the YAML file containing user credentials.
      - CREDENTIALS_FILE=../gatewayd-plugin-auth/credentials.yaml
      # PostgreSQL server version advertised to clients in AuthOk response.
      - SERVER_VERSION=17.4
      # Enable Casbin-based query authorization (optional).
      # When enabled, authenticated queries are checked against the policy.
      # - AUTHORIZATION_ENABLED=true
      # - CASBIN_MODEL_PATH=../gatewayd-plugin-auth/model.conf
      # - CASBIN_POLICY_PATH=../gatewayd-plugin-auth/policy.csv
      # - SENTRY_DSN=https://e9b154400dd9dc7b40c1af839dc4935e@o4504550475038720.ingest.us.sentry.io/4510898014519296
